<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì–´ ë”ë¯¸ ì‚¬ìš©ì ìƒì„±ê¸°</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ì„¤ì • -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        /* í…Œì´ë¸” ìŠ¤íŠ¸ë¼ì´í”„ íš¨ê³¼ë¥¼ ìœ„í•œ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        .result-table tbody tr:nth-child(odd) {
            background-color: #f1f3f6;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-extrabold text-indigo-700">ğŸ‡°ğŸ‡· í•œêµ­ì–´ ë”ë¯¸ ì‚¬ìš©ì ìƒì„±ê¸°</h1>
            <p class="mt-2 text-gray-500">Electron Preload ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ì•ˆì „í•˜ê²Œ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
        </header>

        <!-- ì…ë ¥ ë° ì œì–´ ì˜ì—­ -->
        <div class="flex flex-col sm:flex-row gap-4 mb-8 p-4 bg-indigo-50 rounded-lg shadow-inner">
            <div class="flex-grow">
                <label for="num-users" class="block text-sm font-medium text-gray-700 mb-1">ìƒì„±í•  ì‚¬ìš©ì ìˆ˜ (ìµœëŒ€ 100ëª…)</label>
                <input 
                    type="number" 
                    id="num-users" 
                    value="10" 
                    min="1" 
                    max="100"
                    class="w-full px-4 py-2 border border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                    placeholder="ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                >
            </div>
            <button 
                id="generate-button"
                class="sm:mt-auto px-6 py-2.5 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-300 active:bg-indigo-800"
            >
                ë°ì´í„° ìƒì„±
            </button>
        </div>

        <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
        <div id="results-container" class="mt-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">ğŸ“Š ìƒì„± ê²°ê³¼</h2>
            <p id="status-message" class="text-gray-500 text-center py-4">ì‚¬ìš©ì ìˆ˜ë¥¼ ì…ë ¥í•˜ê³  'ë°ì´í„° ìƒì„±' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
            
            <div id="table-wrapper" class="overflow-x-auto hidden">
                <table class="min-w-full divide-y divide-gray-200 result-table rounded-lg shadow-lg">
                    <thead class="bg-indigo-600 text-white">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-medium uppercase tracking-wider rounded-tl-lg">ì´ë¦„</th>
                            <th class="px-4 py-3 text-left text-sm font-medium uppercase tracking-wider">ì „í™”ë²ˆí˜¸</th>
                            <th class="px-4 py-3 text-left text-sm font-medium uppercase tracking-wider">ì´ë©”ì¼</th>
                            <th class="px-4 py-3 text-left text-sm font-medium uppercase tracking-wider rounded-tr-lg">ë¹„ë°€ë²ˆí˜¸</th>
                        </tr>
                    </thead>
                    <tbody id="user-list-body" class="bg-white divide-y divide-gray-200">
                        <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ì‚½ì…ë©ë‹ˆë‹¤ -->
                    </tbody>
                </table>
            </div>

            <button 
                id="copy-button"
                class="hidden mt-4 w-full px-6 py-3 bg-gray-800 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700 transition duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300 active:bg-gray-900"
            >
                ê²°ê³¼ ë³µì‚¬ (JSON)
            </button>

            <button 
                id="csv-button"
                class="hidden mt-2 w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition duration-200 focus:outline-none focus:ring-4 focus:ring-green-300 active:bg-green-800"
            >
                CSV ë‹¤ìš´ë¡œë“œ
            </button>
            <p id="copy-status" class="text-center mt-2 text-sm text-green-600 hidden">í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
        </div>
    </div>
    <footer class="fixed bottom-3 left-1/2 transform -translate-x-1/2 text-[11px] text-[#6B7280] select-none pointer-events-none">
        Developed by <strong class="text-[#111827] font-semibold">yunsuper</strong>
    </footer>


    <script>
        // â­ï¸ Faker ëª¨ë“ˆì„ ì§ì ‘ ë¡œë“œí•˜ëŠ” ì½”ë“œëŠ” preload.jsë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.
        // ì´ì œ window.fakerApi ê°ì²´ë¥¼ í†µí•´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

        // DOM ìš”ì†Œ ì°¸ì¡°
        const numUsersInput = document.getElementById('num-users');
        const generateButton = document.getElementById('generate-button');
        const userListBody = document.getElementById('user-list-body');
        const statusMessage = document.getElementById('status-message');
        const tableWrapper = document.getElementById('table-wrapper');
        const copyButton = document.getElementById('copy-button');
        const csvButton = document.getElementById('csv-button');
        const copyStatus = document.getElementById('copy-status');

        let latestUsers = []; // ë³µì‚¬ ê¸°ëŠ¥ì„ ìœ„í•´ ìƒì„±ëœ ì‚¬ìš©ì ëª©ë¡ ì €ì¥

        /**
         * ì‚¬ìš©ì ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëª©ë¡ì„ ìƒì„±í•˜ê³  í™”ë©´ì— ë Œë”ë§í•©ë‹ˆë‹¤.
         */
        function generateUsers() {
            // â­ï¸ window.fakerApi ê°ì²´ê°€ ë…¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (typeof window.fakerApi === 'undefined' || typeof window.fakerApi.generateFakeUser !== 'function') {
                statusMessage.textContent = "âŒ ì˜¤ë¥˜ ë°œìƒ: Electron API (fakerApi)ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. main.jsì™€ preload.jsë¥¼ í™•ì¸í•˜ì„¸ìš”.";
                statusMessage.classList.add('text-red-600', 'font-bold');
                return;
            }

            const num = parseInt(numUsersInput.value, 10);
            
            // ì…ë ¥ê°’ ìœ íš¨ì„± ê²€ì‚¬ (1ëª… ì´ìƒ 100ëª… ì´í•˜)
            if (isNaN(num) || num < 1 || num > 100) {
                statusMessage.textContent = "âš ï¸ ì‚¬ìš©ì ìˆ˜ëŠ” 1ëª…ì—ì„œ 100ëª… ì‚¬ì´ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.";
                statusMessage.classList.remove('hidden');
                csvButton.classList.remove('hidden');
                tableWrapper.classList.add('hidden');
                copyButton.classList.add('hidden');
                return;
            }

            statusMessage.textContent = 'ë°ì´í„° ìƒì„± ì¤‘...';
            statusMessage.classList.remove('hidden');
            tableWrapper.classList.add('hidden'); 
            copyButton.classList.add('hidden');
            csvButton.classList.remove('hidden'); 
            copyStatus.classList.add('hidden');

            latestUsers = [];
            
            try {
                // â­ï¸ preload.jsì—ì„œ ë…¸ì¶œëœ generateFakeUser í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
                for (let i = 0; i < num; i++) {
                    latestUsers.push(window.fakerApi.generateFakeUser());
                }

                renderUsers(latestUsers);
                
            } catch (error) {
                 // Preload ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë°œìƒí•œ ì˜¤ë¥˜ê°€ ì´ìª½ìœ¼ë¡œ ë„˜ì–´ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                 statusMessage.textContent = `âŒ ë°ì´í„° ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
                 statusMessage.classList.remove('text-gray-500', 'text-indigo-600', 'font-semibold');
                 statusMessage.classList.add('text-red-600', 'font-bold');
                 console.error("ë°ì´í„° ìƒì„± ì¤‘ ì˜¤ë¥˜:", error);
            }
        }

        /**
         * ìƒì„±ëœ ì‚¬ìš©ì ëª©ë¡ì„ HTML í…Œì´ë¸”ë¡œ ë Œë”ë§í•©ë‹ˆë‹¤.
         * @param {Array<Object>} users 
         */
        function renderUsers(users) {
            userListBody.innerHTML = '';
            
            users.forEach(user => {
                const row = userListBody.insertRow();
                row.className = 'hover:bg-indigo-100 transition duration-150';

                // ì…€ ë°ì´í„° ì‚½ì…
                row.insertCell().textContent = user.fullname;
                row.insertCell().textContent = user.phone;
                row.insertCell().textContent = user.email;
                row.insertCell().textContent = user.password;
            });

            // ìƒíƒœ ì—…ë°ì´íŠ¸ ë° ìš”ì†Œ í‘œì‹œ/ìˆ¨ê¸°ê¸°
            statusMessage.textContent = `${users.length}ëª…ì˜ í•œêµ­ì–´ ë”ë¯¸ ì‚¬ìš©ìê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            statusMessage.classList.remove('text-gray-500');
            statusMessage.classList.add('text-indigo-600', 'font-semibold');
            tableWrapper.classList.remove('hidden');
            copyButton.classList.remove('hidden');
        }

        /**
         * ìƒì„±ëœ JSON ë°ì´í„°ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í•©ë‹ˆë‹¤.
         */
        function copyToClipboard() {
            if (latestUsers.length === 0) return;

            const jsonString = JSON.stringify(latestUsers, null, 2);
            
            try {
                // navigator.clipboard.writeTextë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                navigator.clipboard.writeText(jsonString).then(() => {
                    copyStatus.textContent = "í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (JSON í˜•ì‹)";
                    copyStatus.classList.remove('hidden');
                    
                    // 2ì´ˆ í›„ ë©”ì‹œì§€ ìˆ¨ê¹€
                    setTimeout(() => {
                        copyStatus.classList.add('hidden');
                    }, 2000);

                }).catch(err => {
                    // í´ë¦½ë³´ë“œ API ì‹¤íŒ¨ ì‹œ
                    fallbackCopy(jsonString);
                });

            } catch (err) {
                fallbackCopy(jsonString);
            }
        }
        
        // êµ¬í˜• ë¸Œë¼ìš°ì € ë˜ëŠ” ê¶Œí•œ ë¬¸ì œ ë°œìƒ ì‹œ ëŒ€ì•ˆ ë³µì‚¬ í•¨ìˆ˜
        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed'; 
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    copyStatus.textContent = "í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! (JSON í˜•ì‹)";
                    copyStatus.classList.remove('hidden');
                    setTimeout(() => {
                        copyStatus.classList.add('hidden');
                    }, 2000);
                } else {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (err) {
                 console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
            
            document.body.removeChild(textarea);
        }

        function downloadCSV() {
            if (latestUsers.length === 0) return;

            const header = ["fullname", "phone", "email", "password"];
            const rows = latestUsers.map(user => [
                user.fullname,
                user.phone,
                user.email,
                user.password,
            ]);

            const csvContent = [
                header.join(","), 
                ...rows.map(row => row.join(","))
            ].join("\n");

            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const url = URL.createObjectURL(blob);

            // âœ… ë‚ ì§œ ë¬¸ìì—´ ìƒì„±
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, "0");
            const day = String(today.getDate()).padStart(2, "0");
            const dateString = `${year}-${month}-${day}`;

            // âœ… íŒŒì¼ ì´ë¦„ì— ë‚ ì§œ í¬í•¨
            const filename = `korean_users_${dateString}.csv`;

            const link = document.createElement("a");
            link.href = url;
            link.setAttribute("download", filename);
            link.click();
        }


        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        generateButton.addEventListener('click', generateUsers);
        copyButton.addEventListener('click', copyToClipboard);
        csvButton.addEventListener('click', downloadCSV);
        
        // Enter í‚¤ë¡œ ìƒì„± ìš”ì²­ ì²˜ë¦¬
        numUsersInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); 
                generateUsers();
            }
        });

        // ì´ˆê¸° ë¡œë“œ ì‹œ í•œ ë²ˆ ì‹¤í–‰
        window.onload = () => {
             tableWrapper.classList.add('hidden');
        }

    </script>
</body>
</html>
